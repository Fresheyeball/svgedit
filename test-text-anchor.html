<!DOCTYPE html>
<html>
<head>
    <title>Test Text Anchor Persistence</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Text Anchor Persistence Test</h1>
    
    <div id="results"></div>
    
    <h3>Test SVG with different text alignments:</h3>
    <div id="svg-container"></div>
    
    <script>
        const resultsDiv = document.getElementById('results');
        const svgContainer = document.getElementById('svg-container');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }
        
        // Test SVG with different text alignments
        const testSvg = `<svg width="640" height="480" viewBox="0 0 640 480" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:se="http://svg-edit.googlecode.com">
            <g class="layer">
                <title>Layer 1</title>
                
                <!-- Text with left alignment -->
                <foreignObject x="50" y="50" width="200" height="40" se:type="text" text-anchor="start" font-size="16">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: left; display: block; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Left Aligned Text</div>
                </foreignObject>
                
                <!-- Text with center alignment -->
                <foreignObject x="50" y="120" width="200" height="40" se:type="text" text-anchor="middle" font-size="16">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: center; display: block; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Center Aligned Text</div>
                </foreignObject>
                
                <!-- Text with right alignment -->
                <foreignObject x="50" y="190" width="200" height="40" se:type="text" text-anchor="end" font-size="16">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: right; display: block; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Right Aligned Text</div>
                </foreignObject>
                
                <!-- Text with justify alignment -->
                <foreignObject x="50" y="260" width="200" height="60" se:type="text" text-anchor="justify" font-size="16">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: justify; display: block; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Justified text should spread across the full width of the container when there are multiple lines.</div>
                </foreignObject>
            </g>
        </svg>`;
        
        // Parse and display the SVG
        const parser = new DOMParser();
        const svgDoc = parser.parseFromString(testSvg, 'image/svg+xml');
        const svgElement = svgDoc.documentElement;
        svgContainer.appendChild(svgElement);
        
        // Test the attributes and styles
        const foreignObjects = svgElement.querySelectorAll('foreignObject[se\\:type="text"]');
        
        addResult(`Found ${foreignObjects.length} text elements`, 'info');
        
        foreignObjects.forEach((fo, index) => {
            const textAnchor = fo.getAttribute('text-anchor');
            const div = fo.querySelector('div');
            const textAlign = div ? div.style.textAlign : 'none';
            const text = div ? div.textContent : 'no text';
            
            addResult(`Element ${index + 1}: text-anchor="${textAnchor}", text-align="${textAlign}", content="${text}"`, 'info');
            
            // Check if the mapping is correct
            const expectedAlign = {
                'start': 'left',
                'middle': 'center', 
                'end': 'right',
                'justify': 'justify'
            }[textAnchor];
            
            if (textAlign === expectedAlign) {
                addResult(`✓ Element ${index + 1} alignment is correct`, 'pass');
            } else {
                addResult(`✗ Element ${index + 1} alignment mismatch: expected "${expectedAlign}", got "${textAlign}"`, 'fail');
            }
        });
    </script>
</body>
</html>