<!DOCTYPE html>
<html>
<head>
    <title>Test Text Alignment Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        iframe { width: 100%; height: 600px; border: 1px solid #ccc; }
        .test-instructions { background: #fff3cd; color: #856404; padding: 15px; margin: 15px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Text Alignment Persistence Test</h1>
    
    <div class="test-instructions">
        <h3>Manual Test Instructions:</h3>
        <ol>
            <li>In SVGEdit below, click the Text tool (T)</li>
            <li>Click on the canvas to create a text element</li>
            <li>Type some text (e.g., "Test Alignment")</li>
            <li>Make sure the text is selected</li>
            <li><strong>Change the alignment using the alignment dropdown to "Left"</strong></li>
            <li>Click View → Source to see the SVG code</li>
            <li>Look for the foreignObject element - it should have <code>text-anchor="start"</code></li>
            <li>The div inside should have <code>style="...text-align: left..."</code></li>
            <li>Click "Apply Changes" to return to the editor</li>
            <li>Save the document (Ctrl+S or File → Save)</li>
            <li><strong>Refresh the page and open the same document</strong></li>
            <li>Check if the text is still left-aligned</li>
        </ol>
        <p><strong>Expected Result:</strong> Text alignment should persist after page reload.</p>
    </div>
    
    <div id="test-results"></div>
    
    <iframe src="http://localhost:8000/src/editor/index.html" title="SVGEdit Test"></iframe>
    
    <script>
        const resultsDiv = document.getElementById('test-results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = new Date().toLocaleTimeString() + ': ' + message;
            resultsDiv.appendChild(div);
        }
        
        addResult('SVGEdit loaded - ready for testing', 'info');
        
        // Add some sample SVGs for testing
        const testSvgs = {
            'left-aligned': `<svg width="640" height="480" viewBox="0 0 640 480" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:se="http://svg-edit.googlecode.com">
                <g class="layer">
                    <title>Layer 1</title>
                    <foreignObject x="100" y="100" width="200" height="40" se:type="text" text-anchor="start" font-size="16">
                        <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: left; display: block; white-space: pre-wrap; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Left Aligned Text</div>
                    </foreignObject>
                </g>
            </svg>`,
            'center-aligned': `<svg width="640" height="480" viewBox="0 0 640 480" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:se="http://svg-edit.googlecode.com">
                <g class="layer">
                    <title>Layer 1</title>
                    <foreignObject x="100" y="100" width="200" height="40" se:type="text" text-anchor="middle" font-size="16">
                        <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: center; display: block; white-space: pre-wrap; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Center Aligned Text</div>
                    </foreignObject>
                </g>
            </svg>`,
            'right-aligned': `<svg width="640" height="480" viewBox="0 0 640 480" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://svg-edit.googlecode.com">
                <g class="layer">
                    <title>Layer 1</title>
                    <foreignObject x="100" y="100" width="200" height="40" se:type="text" text-anchor="end" font-size="16">
                        <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%; font-size: 16px; text-align: right; display: block; white-space: pre-wrap; overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; min-height: 100%; outline: none;">Right Aligned Text</div>
                    </foreignObject>
                </g>
            </svg>`
        };
        
        Object.keys(testSvgs).forEach(key => {
            const button = document.createElement('button');
            button.textContent = `Test ${key.replace('-', ' ')} text`;
            button.style.margin = '5px';
            button.onclick = () => {
                addResult(`Sample ${key} SVG: Copy and paste this into SVGEdit's source view to test`, 'info');
                navigator.clipboard.writeText(testSvgs[key]).then(() => {
                    addResult(`${key} SVG copied to clipboard`, 'pass');
                }).catch(() => {
                    addResult(`Failed to copy to clipboard - here's the SVG: ${testSvgs[key].substring(0, 100)}...`, 'info');
                });
            };
            resultsDiv.appendChild(button);
        });
    </script>
</body>
</html>