<!DOCTYPE html>
<html>
<head>
    <title>Test Synchronization Function</title>
    <style>
        .test-svg { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background: #e6ffe6; }
        .error { background: #ffe6e6; }
    </style>
</head>
<body>
    <h1>Test Text Alignment Synchronization</h1>
    
    <h3>Test Case: SVG with text-anchor="start" but no text-align style</h3>
    <div id="test-container" class="test-svg"></div>
    <div id="result" class="result"></div>
    
    <script>
        // Create test SVG with text-anchor but no text-align style
        const testSVG = `
        <svg width="400" height="200" xmlns="http://www.w3.org/2000/svg" xmlns:se="http://svg-edit.googlecode.com">
            <foreignObject x="50" y="50" width="300" height="50" se:type="text" text-anchor="start" font-size="16">
                <div xmlns="http://www.w3.org/1999/xhtml" 
                     style="width: 100%; height: 100%; font-size: 16px; display: block; 
                            overflow-wrap: break-word; padding: 4px; box-sizing: border-box; cursor: text; 
                            min-height: 100%; outline: none; border: 1px solid red;">
                    This text has NO text-align style initially
                </div>
            </foreignObject>
        </svg>`;
        
        // Insert the SVG
        document.getElementById('test-container').innerHTML = testSVG;
        
        // Implement the synchronizeTextStyles function (copied from our fix)
        function synchronizeTextStyles(elem) {
            if (elem.nodeType === 1) {
                // Process foreignObject text elements
                if (elem.localName === 'foreignObject' && elem.getAttribute('se:type') === 'text') {
                    const textDiv = elem.querySelector('div');
                    if (textDiv) {
                        const textAnchor = elem.getAttribute('text-anchor');
                        if (textAnchor) {
                            const textAlignMap = {
                                start: 'left',
                                middle: 'center',
                                end: 'right',
                                justify: 'justify'
                            };
                            const expectedAlign = textAlignMap[textAnchor] || 'left';
                            textDiv.style.textAlign = expectedAlign;
                            console.log('SYNC: Applied', textAnchor, '->', expectedAlign);
                        }
                    }
                }
                
                // Recursively process child elements
                for (let i = 0; i < elem.children.length; i++) {
                    synchronizeTextStyles(elem.children[i]);
                }
            }
        }
        
        // Wait a moment then test
        setTimeout(() => {
            const container = document.getElementById('test-container');
            const fo = container.querySelector('foreignObject[se\\:type="text"]');
            const div = fo ? fo.querySelector('div') : null;
            
            let beforeResult = 'NOT FOUND';
            if (div) {
                const textAnchor = fo.getAttribute('text-anchor');
                const beforeAlign = div.style.textAlign || '(empty)';
                const beforeComputed = getComputedStyle(div).textAlign;
                beforeResult = `text-anchor="${textAnchor}", inline="${beforeAlign}", computed="${beforeComputed}"`;
            }
            
            console.log('BEFORE SYNC:', beforeResult);
            
            // Apply our synchronization function
            synchronizeTextStyles(container);
            
            // Check after
            let afterResult = 'NOT FOUND';
            if (div) {
                const textAnchor = fo.getAttribute('text-anchor');
                const afterAlign = div.style.textAlign || '(empty)';
                const afterComputed = getComputedStyle(div).textAlign;
                afterResult = `text-anchor="${textAnchor}", inline="${afterAlign}", computed="${afterComputed}"`;
                
                // Update div border to show it's working
                div.style.border = afterAlign === 'left' ? '2px solid green' : '2px solid red';
            }
            
            console.log('AFTER SYNC:', afterResult);
            
            const isSuccess = afterResult.includes('inline="left"') && afterResult.includes('computed="left"');
            document.getElementById('result').innerHTML = 
                `<div class="${isSuccess ? 'success' : 'error'}">
                    <strong>${isSuccess ? 'SUCCESS' : 'FAILED'}!</strong><br>
                    BEFORE: ${beforeResult}<br>
                    AFTER: ${afterResult}
                </div>`;
        }, 500);
    </script>
</body>
</html>